---
title: "Univariate Analysis"
author: "Daniel Reyes"
date: "3/1/2021"
output:
  pdf_document: 
    toc: yes
  html_document: default
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r Scripts, include=FALSE}
source("00_packages_v1.R", local = knitr::knit_global())
source("01_diagnostic function_v1.R", local = knitr::knit_global())
source("03_data loading_v1.R", local = knitr::knit_global())
source("04_Models per trait_v1.R", local = knitr::knit_global())
```

--------------


I ran different models per trait with un-transformed data, log-transformed and sqrt-transformed data. Then I used a custom *diagnostic* function and the package *DHARMa* to compare between models. Then I selected the model that better fit the assumptions. The model I will show here are the ones selected. Finally, I used the package *emmeans* to estimate the marginal means per model.


## Model 1: trait \~ mainland/island + year + (1\|ID)

This is the first model that looks at the differences between *Tribulus* mericarps, flowers and leaves from mainland and island populations.


\newpage

## Mericarps

##### Length -\> Sqrt-transformed

```{r Model 1. Length, echo=FALSE, fig.align='left'}
par(mfrow = c(1,3))

diagnostic(resid(meri_length_m3))

par(mfrow = c(1,2))
plotResiduals(meri_length_m3)
plotQQunif(meri_length_m3)

# Anova
Anova(meri_length_m3)

```

\newpage

##### Width -\> sqrt-transformed

```{r Model 1. Width, echo=FALSE, fig.align='left'}
  par(mfrow = c(1,2))
  plotResiduals(meri_width_m3)
  plotQQunif(meri_width_m3)

  par(mfrow = c(1,3))
  diagnostic(resid(meri_width_m3))

  # Anova
  Anova(meri_width_m3)

```

\newpage

##### Depth -\> Not transformed

```{r Model 1. Depth, echo=FALSE, fig.align='left'}
par(mfrow = c(1,3))
diagnostic(resid(meri_depth_m1))
# Kurtosis and Skewness

par(mfrow = c(1,2))
plotResiduals(meri_depth_m1)
plotQQunif(meri_depth_m1)

# Anova
Anova(meri_depth_m1)

```

\newpage

#### Spine Length -\> Not transformed

```{r Model 1. Spine Length, echo=FALSE, fig.align='left'}
par(mfrow = c(1,3))
diagnostic(resid(meri_spine.length_m1))
# Kurtosis and Skewness

par(mfrow = c(1,2))
plotResiduals(meri_spine.length_m1)
plotQQunif(meri_spine.length_m1)

# Anova
Anova(meri_spine.length_m1)

```

\newpage

#### Spine Tip Distance -\> Not transformed

```{r Model 1. Spine Tip Distance, echo=FALSE, fig.align='left'}
par(mfrow = c(1,3))
diagnostic(resid(meri_tip.distance_m1))
# Kurtosis and Skewness

par(mfrow = c(1,2))
plotResiduals(meri_tip.distance_m1)
plotQQunif(meri_tip.distance_m1)

# Anova
Anova(meri_tip.distance_m1)

```

\newpage

#### Spine Number -\> Not transformed

***For spine number, I think it is a count trait, so I used this model:***

*glm(spine_num \~ mainland_island + year_collected, data = meri_spine.number, family = poisson)*

But the diagnostic of this model looks different. How should I evaluate de assumptions of this model?

```{r Model 1. Spine Number, echo=FALSE, message=FALSE, warning=FALSE, fig.align='left'}
par(mfrow = c(1,3))
diagnostic(resid(meri_spine.number_m1))
# Kurtosis and Skewness

par(mfrow = c(1,2))
plotResiduals(meri_spine.number_m1)
plotQQunif(meri_spine.number_m1)

# Anova
Anova(meri_spine.number_m1)

```

\newpage

#### Lower -\> Not transformed

***For lower spines, I think it is a count trait, so I used this model:***

*meri_lower.spines_m1 \<- glm(lower_spines \~ mainland_island + year_collected, data = meri_lower.spines, family = "binomial")*

```{r Model 1. Lower Spine, echo=FALSE, fig.align='left'}
par(mfrow = c(1,3))
diagnostic(resid(meri_lower.spines_m1))
# Kurtosis and Skewness

par(mfrow = c(1,2))
plotResiduals(meri_lower.spines_m1)
plotQQunif(meri_lower.spines_m1)

# Anova
Anova(meri_lower.spines_m1)

```

\newpage

## Flowers

#### Petal length -\> Not transformed

```{r Model 1. Petal Length, echo=FALSE, fig.align='left'}
par(mfrow = c(1,3))
diagnostic(resid(flower_m1))
# Kurtosis and Skewness

par(mfrow = c(1,2))
plotResiduals(flower_m1)
plotQQunif(flower_m1)

# Anova
Anova(flower_m1)

```

\newpage

## Leaves

#### Leaf Length -\> Log Transformed

```{r Model 1. Leaf Length, echo=FALSE, fig.align='left'}
par(mfrow = c(1,3))
diagnostic(resid(leaf_length_m2))
# Kurtosis and Skewness

par(mfrow = c(1,2))
plotResiduals(leaf_length_m2)
plotQQunif(leaf_length_m2)

# Anova
Anova(leaf_length_m2)

```

\newpage

#### Leaflet Length -\> Log Transformed

```{r Model 1. Leaflet Length, echo=FALSE, fig.align='left'}
par(mfrow = c(1,3))
diagnostic(resid(leaflet_length_m2))
# Kurtosis and Skewness

par(mfrow = c(1,2))
plotResiduals(leaflet_length_m2)
plotQQunif(leaflet_length_m2)

# Anova
Anova(leaflet_length_m2)

```

\newpage

#### Leaflet number -\> Not transformed

***For leaflet number, I think it is a count trait, so I used this model:***

*glm(number_of_leaflets \~ mainland_island + year_collected, family = poisson, data=leaf_length)*

```{r Model 1. Leaflet Number, echo=FALSE, fig.align='left'}
par(mfrow = c(1,3))
diagnostic(resid(leaflet_num_m1))
# Kurtosis and Skewness

par(mfrow = c(1,2))
plotResiduals(leaflet_num_m1)
plotQQunif(leaflet_num_m1)

# Anova
Anova(leaflet_num_m1)

```

\newpage

## Model 1 LS means

#### Mericarps:

##### Length

```{r LS means. Mericarps Length, echo=FALSE}
EM_length
```

##### Width

```{r LS means. Mericarps Width, echo=FALSE}
EM_width
```

##### Depth

```{r LS means. Mericarps Depth, echo=FALSE}
EM_depth
```

##### Spine Length

```{r LS means. Mericarps Spine Length, echo=FALSE}
EM_spine
```

##### Spine Tip Distance

```{r LS means. Mericarps Tip distance, echo=F}
EM_tip.dist
```

##### Spine Number

```{r LS means. Mericarps Spine Number, echo=F}
EM_spine.num
```

##### Lower Spines

```{r LS means. Mericarps Lower Spines, echo=F}
EM_lower
```

\newpage

## Mericarp LS means plots

```{r Model 1. Mericarps LS Means, echo=FALSE, fig.align='left'}
par(mfrow = c(1,3))
plot(EM_length) + labs(title = "Mericarp Length")
plot(EM_width) + labs(title = "Mericarp Width")
plot(EM_depth) + labs(title = "Mericarp Depth")
plot(EM_spine) + labs(title = "Mericarp Spine Length")
plot(EM_tip.dist) + labs(title = "Mericarp Spine Tip Distance")
plot(EM_spine.num) + labs(title = "Mericarp Spine number")
plot(EM_lower) + labs(title = "Mericarp Lower Spines")

```

In general mericarps from mainland populations are smaller than island mericarps. However, spine size seems to differ with mainland populations having longer tip distances and higher spine numbers than island populations.

\newpage

#### Flowers

## Petal Length

```{r LS means. Flower, echo=F}
EM_flower
plot(EM_flower) + labs(title = "Petal Length")
```

\newpage

#### Leaves

##### Leaf Length

```{r LS means. Leaves, echo=F}
EM_leaf
```

##### Leaflet Length

```{r LS means. Leaflets, echo=F}
EM_leaflet
```

##### Leaflet Number

```{r LS means. Leaflet Number, echo=F}
EM_leaflet.num
```

\newpage

## Leaves LS means plots

```{r Model 1. Leaves LS Means, echo=FALSE, fig.align='left'}
par(mfrow = c(1,3))
plot(EM_leaf) + labs(title = "Leaf Length")
plot(EM_leaflet) + labs(title = "Leaflet Length")
plot(EM_leaflet.num) + labs(title = "Leaflet Number")
```

Mainland populations seems to have smaller leaves and less leaflets than island populations.

\newpage

## Model 2 trait \~ galapagos/other islands + year + (1\|ID)

This is the second model, that shows the differences of *Tribulus* traits from Galapagos populations and other *Islands*.

## Flowers

#### Petal length -\> Root squared transformed data

```{r Model 2. Petal Length, echo=FALSE, fig.align='left'}
par(mfrow = c(1,3))
diagnostic(resid(flower_m6))
# Kurtosis and Skewness

par(mfrow = c(1,2))
plotResiduals(flower_m6)
plotQQunif(flower_m6)

# Anova
Anova(flower_m6)

```

\newpage

## Leaves

#### Leaf Length -\> Log Transformed

```{r Model 2. Leaf Length, echo=FALSE, fig.align='left'}
par(mfrow = c(1,3))
diagnostic(resid(leaf_length_m5))
# Kurtosis and Skewness

par(mfrow = c(1,2))
plotResiduals(leaf_length_m5)
plotQQunif(leaf_length_m5)

# Anova
Anova(leaf_length_m5)

```

\newpage

#### Leaflet Length -\> Log Transformed

```{r Model 2. Leaflet Length, echo=FALSE, fig.align='left'}
par(mfrow = c(1,3))
diagnostic(resid(leaflet_length_m5))
# Kurtosis and Skewness

par(mfrow = c(1,2))
plotResiduals(leaflet_length_m5)
plotQQunif(leaflet_length_m5)

# Anova
Anova(leaflet_length_m5)

```

\newpage

#### Leaflet number -\> Not transformed

***For leaflet number, I think it is a count trait, so I used this model:***

*glm(number_of_leaflets \~ mainland_island + year_collected, family = poisson, data=leaf_length)*

```{r Model 2. Leaflet Number, echo=FALSE, fig.align='left'}
par(mfrow = c(1,3))
diagnostic(resid(leaflet_num_m2))
# Kurtosis and Skewness

par(mfrow = c(1,2))
plotResiduals(leaflet_num_m2)
plotQQunif(leaflet_num_m2)

# Anova
Anova(leaflet_num_m2)

```

\newpage

## Model 2 LS means

## Flowers

##### Petal Length

```{r LS means2. Flower, echo=F}
EM_flower2
plot(EM_flower2) + labs(title = "Petal Length")
```

Petal length from Galapagos seems to be smaller than other island systems.

#### Leaves

##### Leaf Length

```{r LS means2. Leaves, echo=F}
EM_leaf2
```

##### Leaflet Length

```{r LS means2. Leaflets, echo=F}
EM_leaflet2
```

##### Leaflet Number

```{r LS means2. Leaflet Number, echo=F}
EM_leaflet.num2
```

\newpage

## Leaves LS means plots

```{r Model 2. Leaves LS Means, echo=FALSE, fig.align='left'}
par(mfrow = c(1,3))
plot(EM_leaf2) + labs(title = "Leaf Length")
plot(EM_leaflet2) + labs(title = "Leaflet Length")
plot(EM_leaflet.num2) + labs(title = "Leaflet Number")
```

Leaf, leaflet are smaller in the Galapagos compared to other islands. Leaflet number are also fewer in Galapagos.

\newpage

## Model 3: trait \~ finch_beak + year + (1\|ID)

For this third model I filter the samples from Galapagos only. Then I defined the Islands that have different finch communities based on the presence or absence of large ground finches: *G. magnirostris*, *G. cornirostris*.

Floreana, San Cristobal, Santa Fe, Champion, Baltra, Enderby, Gardner and Daphne Major, previous 1983 are considered **without** magnis or cornirostris.

The rest of the Islands are considered **with** large ground finches.

\newpage

## Mericarps

##### Length -\> Not transformed data

```{r Model 3. Length, echo=FALSE, fig.align='left'}
par(mfrow = c(1,3))
diagnostic(resid(meri_length_m4))
# Kurtosis and Skewness

par(mfrow = c(1,2))
plotResiduals(meri_length_m4)
plotQQunif(meri_length_m4)

# Anova
Anova(meri_length_m4)
```

\newpage

##### Width -\> sqrt-transformed

```{r Model 3. Width, echo=FALSE, fig.align='left'}
par(mfrow = c(1,3))
diagnostic(resid(meri_width_m6))
# Kurtosis and Skewness

par(mfrow = c(1,2))
plotResiduals(meri_width_m6)
plotQQunif(meri_width_m6)

# Anova
Anova(meri_width_m6)

```

\newpage

##### Depth -\> Not transformed

```{r Model 3. Depth, echo=FALSE, fig.align='left'}
par(mfrow = c(1,3))
diagnostic(resid(meri_depth_m4))
# Kurtosis and Skewness

par(mfrow = c(1,2))
plotResiduals(meri_depth_m4)
plotQQunif(meri_depth_m4)

# Anova
Anova(meri_depth_m4)

```

\newpage

#### Spine Length -\> Not transformed

```{r Model 3. Spine Length, echo=FALSE, fig.align='left'}
par(mfrow = c(1,3))
diagnostic(resid(meri_spine.length_m4))
# Kurtosis and Skewness

par(mfrow = c(1,2))
plotResiduals(meri_spine.length_m4)
plotQQunif(meri_spine.length_m4)

# Anova
Anova(meri_spine.length_m4)

```

\newpage

#### Spine Tip Distance -\> Not transformed

```{r Model 3. Spine Tip Distance, echo=FALSE, fig.align='left'}
par(mfrow = c(1,3))
diagnostic(resid(meri_tip.distance_m4))
# Kurtosis and Skewness

par(mfrow = c(1,2))
plotResiduals(meri_tip.distance_m4)
plotQQunif(meri_tip.distance_m4)

# Anova
Anova(meri_tip.distance_m1)

```

\newpage

#### Spine Number -\> Not transformed

***For spine number, I think it is a count trait, so I used this model:***

*glm(spine_num \~ mainland_island + year_collected, data = meri_spine.number, family = poisson)*

But the diagnostic of this model looks different. How should I evaluate de assumptions of this model?

```{r Model 3. Spine Number, echo=FALSE, fig.align='left'}
par(mfrow = c(1,3))
diagnostic(resid(meri_spine.number_m2))
# Kurtosis and Skewness

par(mfrow = c(1,2))
plotResiduals(meri_spine.number_m2)
plotQQunif(meri_spine.number_m2)

# Anova
Anova(meri_spine.number_m2)

```

\newpage

#### Lower -\> Not transformed

***For lower spines, I think it is a count trait, so I used this model:***

*meri_lower.spines_m1 \<- glm(lower_spines \~ mainland_island + year_collected, data = meri_lower.spines, family = "binomial")*

```{r Model 3. Lower Spine, echo=FALSE, fig.align='left'}
par(mfrow = c(1,3))
diagnostic(resid(meri_lower.spines_m2))
# Kurtosis and Skewness

par(mfrow = c(1,2))
plotResiduals(meri_lower.spines_m2)
plotQQunif(meri_lower.spines_m2)

# Anova
Anova(meri_lower.spines_m2)

```

\newpage

## Flowers

#### Petal length -\> Not transformed

```{r Model 3. Petal Length, echo=FALSE, fig.align='left'}
par(mfrow = c(1,3))
diagnostic(resid(flower_m7))
# Kurtosis and Skewness

par(mfrow = c(1,2))
plotResiduals(flower_m7)
plotQQunif(flower_m7)

# Anova
Anova(flower_m7)

```

\newpage

## Leaves

#### Leaf Length -\> Squared Root Transformed

```{r Model 3. Leaf Length, echo=FALSE, fig.align='left'}
par(mfrow = c(1,3))
diagnostic(resid(leaf_length_m9))
# Kurtosis and Skewness

par(mfrow = c(1,2))
plotResiduals(leaf_length_m9)
plotQQunif(leaf_length_m9)

# Anova
Anova(leaf_length_m9)

```

\newpage

#### Leaflet Length -\> Log Transformed

```{r Model 3. Leaflet Length, echo=FALSE, fig.align='left'}
par(mfrow = c(1,3))
diagnostic(resid(leaflet_length_m8))
# Kurtosis and Skewness

par(mfrow = c(1,2))
plotResiduals(leaflet_length_m8)
plotQQunif(leaflet_length_m8)

# Anova
Anova(leaflet_length_m8)

```

\newpage

#### Leaflet number -\> Not transformed

***For leaflet number, I think it is a count trait, so I used this model:***

*glm(number_of_leaflets \~ mainland_island + year_collected, family = poisson, data=leaf_length)*

```{r Model 3. Leaflet Number, echo=FALSE, fig.align='left'}
par(mfrow = c(1,3))
diagnostic(resid(leaflet_num_m3))
# Kurtosis and Skewness

par(mfrow = c(1,2))
plotResiduals(leaflet_num_m3)
plotQQunif(leaflet_num_m3)

# Anova
Anova(leaflet_num_m3)

```

\newpage

## Model 3 LS means

## Mericarps:

##### Length

```{r LS means3. Mericarps Length, echo=FALSE}
EM_length3
```

##### Width

```{r LS means3. Mericarps Width, echo=FALSE}
EM_width3
```

##### Depth

```{r LS means3. Mericarps Depth, echo=FALSE}
EM_depth3
```

##### Spine Length

```{r LS means3. Mericarps Spine Length, echo=FALSE}
EM_spine3
```

##### Spine Tip Distance

```{r LS means3. Mericarps Tip distance, echo=F}
EM_tip.dist3
```

##### Spine Number

```{r LS means3. Mericarps Spine Number, echo=F}
EM_spine.num3
```

##### Lower Spines

```{r LS means3. Mericarps Lower Spines, echo=F}
EM_lower3
```

\newpage

## Mericarp LS means plots

```{r Model 3. Mericarps LS Means, echo=FALSE, fig.align='left'}
par(mfrow = c(1,3))
plot(EM_length3) + labs(title = "Mericarp Length")
plot(EM_width3) + labs(title = "Mericarp Width")
plot(EM_depth3) + labs(title = "Mericarp Depth")
plot(EM_spine3) + labs(title = "Mericarp Spine Length")
plot(EM_tip.dist3) + labs(title = "Mericarp Spine Tip Distance")
plot(EM_spine.num3) + labs(title = "Mericarp Spine number")
plot(EM_lower3) + labs(title = "Mericarp Lower Spines")

```

Within the Galapagos Islands *Tribulus* mericarps have differences associated to finch communities. Mericarps that are **larger** in length (more seeds) and have **lower spines** are associated with large finch communities.

Width, Depth, Spine Length, Tip Distance and Spine Number do not show a large difference between communities.

\newpage

## Flowers

##### Petal Length

```{r LS means3. Flower, echo=F}
EM_flower3
plot(EM_flower3) + labs(title = "Petal Length")
```

## Leaves

##### Leaf Length

```{r LS means3. Leaves, echo=F}
EM_leaf3
```

##### Leaflet Length

```{r LS means3. Leaflets, echo=F}
EM_leaflet3
```

##### Leaflet Number

```{r LS means3. Leaflet Number, echo=F}
EM_leaflet.num3
```

\newpage

## Leaves LS means plots

```{r Model 3. Leaves LS Means, echo=FALSE, fig.align='left'}
par(mfrow = c(1,3))
plot(EM_leaf3) + labs(title = "Leaf Length")
plot(EM_leaflet3) + labs(title = "Leaflet Length")
plot(EM_leaflet.num3) + labs(title = "Leaflet Number")
```
